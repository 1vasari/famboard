<div class="content">
  <div class="is-clearfix">
    <h1 style="float: left;">{{name}} - {{month}}</h1>

    <button class="button" id="lock-button" style="float: right;">
      <span class="icon">
        <i id="lock-icon"></i> <!-- Icon class is populated by JS below -->
      </span>
    </button>
  </div>

  <p>
    <a href="/?week={{previousWeekEpoch}}">Previous</a> | {{#if showTodayLink}}<a href="/">Today</a> |{{/if}} <a href="/?week={{nextWeekEpoch}}">Next</a>
  </p>

  <table class="table">
    {{#each days}}
      <tr>
        <td>
          {{title}}
        </td>
        <td>
          <ul>
            {{#each events}}
              <li>
                {{title}}
                {{#if description}} - {{description}}{{/if}}
                <a href="/event/edit/{{_id}}?referer={{../../week}}" class="toggleable-edit-control">
                  (edit)
                </a>
                <a href="/event/delete/{{_id}}?referer={{../../week}}" class="toggleable-edit-control">
                  (delete)
                </a>
              </li>
            {{/each}}
          </ul>
        </td>
        <td>
          <a href="/event/new?date={{date}}&referer={{../week}}" class="toggleable-edit-control">
            (+)
          </a>
        </td>
      </tr>
    {{/each}}
  </table>

</content>

<script type="text/javascript">
  window.onload = () => {
    const states = ['locked', 'unlocked'];
    let state = window.localStorage.getItem('lockedState') || states[0];

    const isLocked = () => state === states[0];
    const toggle = () => update(state = states[Number(isLocked())]);
    const update = (state) => {
      ico.className = ['fas', isLocked() ? 'fa-lock' : 'fa-lock-open'].join(' ');
      const els = document.getElementsByClassName('toggleable-edit-control');
      for (let i = 0; i < els.length; i-=-1) {
        els[i].style.display = isLocked() ? 'none' : '';
      }
      window.localStorage.setItem('lockedState', state);
    };

    const btn = document.getElementById('lock-button');
    const ico = document.getElementById('lock-icon');

    btn.addEventListener('click', toggle);

    update(state);
  };
</script>
